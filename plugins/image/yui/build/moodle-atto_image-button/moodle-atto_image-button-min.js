YUI.add("moodle-atto_image-button",function(e,t){M.atto_image=M.atto_image||{dialogue:null,selection:null,init:function(t){var n=function(t,n){t.preventDefault(),M.editor_atto.is_active(n)||M.editor_atto.focus(n),M.atto_image.selection=M.editor_atto.get_selection();if(M.atto_image.selection!==!1){var r;M.atto_image.dialogue?r=M.atto_image.dialogue:r=new M.core.dialogue({visible:!1,modal:!0,close:!0,draggable:!0}),r.set("bodyContent",M.atto_image.get_form_content(n)),r.set("headerContent",M.util.get_string("createimage","atto_image")),r.render(),r.centerDialogue(),M.atto_image.dialogue=r;var i=M.editor_atto.get_selection_text(),s=0,o=[];for(s=0;s<i.childNodes.length;s++){var u=i.childNodes[0];o.length===0&&(u.nodeName.toLowerCase()==="img"?o[0]=u:u.getElementsByTagName&&(o=u.getElementsByTagName("img")))}if(o.length>0){var a=e.one(o[0]),f=a.getAttribute("width"),l=a.getAttribute("height");f>0&&e.one("#atto_image_widthentry").set("value",f),l>0&&e.one("#atto_image_heightentry").set("value",l),e.one("#atto_image_preview").set("src",a.get("src")),e.one("#atto_image_preview").setStyle("display","inline"),e.one("#atto_image_altentry").set("value",a.get("alt")),e.one("#atto_image_urlentry").set("value",a.get("src"));var c=a.get("role");c==="presentation"&&e.one("#atto_image_presentation").set("checked","checked")}r.show()}};M.editor_atto.add_toolbar_button(t.elementid,"image",t.icon,t.group,n,this)},open_filepicker:function(e){var t=this.getAttribute("data-editor");e.preventDefault(),M.editor_atto.show_filepicker(t,"image",M.atto_image.filepicker_callback)},filepicker_callback:function(t){if(t.url!==""){var n=e.one("#atto_image_urlentry");n.set("value",t.url);var r=new Image;r.onload=function(){e.one("#atto_image_widthentry").set("value",this.width),e.one("#atto_image_heightentry").set("value",this.height),e.one("#atto_image_preview").set("src",this.src),e.one("#atto_image_preview").setStyle("display","inline")},r.src=t.url}},url_changed:function(){var t=e.one("#atto_image_urlentry");if(t.get("value")!==""){var n=new Image;n.onload=function(){var t;t=e.one("#atto_image_widthentry"),t.get("value")===""&&t.set("value",this.width),t=e.one("#atto_image_heightentry"),t.get("value")===""&&t.set("value",this.height),t=e.one("#atto_image_preview"),t.set("src",this.src),t.setStyle("display","inline")},n.src=t.get("value")}},set_image:function(t,n){var r=t.currentTarget.ancestor(".atto_form").one("#atto_image_urlentry"),i=r.get("value");r=t.currentTarget.ancestor(".atto_form").one("#atto_image_altentry");var s=r.get("value");r=t.currentTarget.ancestor(".atto_form").one("#atto_image_widthentry");var o=r.get("value");r=t.currentTarget.ancestor(".atto_form").one("#atto_image_heightentry");var u=r.get("value");r=t.currentTarget.ancestor(".atto_form").one("#atto_image_presentation");var a=r.get("checked");t.preventDefault();if(s===""&&!a){var f=t.currentTarget.ancestor(".atto_form").one("#atto_image_altwarning");f.setStyle("display","block"),r=t.currentTarget.ancestor(".atto_form").one("#atto_image_widthentry"),r.setAttribute("aria-invalid",!0),r=t.currentTarget.ancestor(".atto_form").one("#atto_image_presentation"),r.setAttribute("aria-invalid",!0);return}M.atto_image.dialogue.hide();if(i!==""){M.editor_atto.set_selection(M.atto_image.selection);var l='<img src="'+e.Escape.html(i)+'" alt="'+e.Escape.html(s)+'"';o&&(l+=' width="'+e.Escape.html(o)+'"'),u&&(l+=' height="'+e.Escape.html(u)+'"'),a&&(l+=' role="presentation"'),l+="/>",document.selection&&document.selection.createRange().pasteHTML?document.selection.createRange().pasteHTML(l):document.execCommand("insertHTML",!1,l),M.editor_atto.text_updated(n)}},get_form_content:function(t){var n=e.Node.create('<form class="atto_form"><label for="atto_image_urlentry">'+M.util.get_string("enterurl","atto_image")+"</label>"+'<input class="fullwidth" type="url" value="" id="atto_image_urlentry" size="32"/>'+"<br/>"+'<button id="openimagebrowser" data-editor="'+e.Escape.html(t)+'">'+M.util.get_string("browserepositories","atto_image")+"</button>"+"<br/>"+'<div style="display:none" role="alert" id="atto_image_altwarning" class="warning">'+M.util.get_string("presentationoraltrequired","atto_image")+"</div>"+'<label for="atto_image_altentry">'+M.util.get_string("enteralt","atto_image")+"</label>"+'<input class="fullwidth" type="text" value="" id="atto_image_altentry" size="32"/>'+"<br/>"+'<input type="checkbox" id="atto_image_presentation"/>'+'<label class="sameline" for="atto_image_presentation">'+M.util.get_string("presentation","atto_image")+"</label>"+"<br/>"+'<label class="sameline" for="atto_image_widthentry">'+M.util.get_string("width","atto_image")+"</label>"+'<input type="text" value="" id="atto_image_widthentry" size="10"/>'+"<br/>"+'<label class="sameline" for="atto_image_heightentry">'+M.util.get_string("height","atto_image")+"</label>"+'<input type="text" value="" id="atto_image_heightentry" size="10"/>'+"<br/>"+'<label for="atto_image_preview">'+M.util.get_string("preview","atto_image")+"</label>"+'<img src="#" width="200" id="atto_image_preview" alt="" style="display: none;"/>'+'<div class="mdl-align">'+"<br/>"+'<button id="atto_image_urlentrysubmit">'+M.util.get_string("createimage","atto_image")+"</button>"+"</div>"+"</form>"+"<hr/>"+M.util.get_string("accessibilityhint","atto_image"));return n.one("#atto_image_urlentry").on("blur",M.atto_image.url_changed,this),n.one("#atto_image_urlentrysubmit").on("click",M.atto_image.set_image,this,t),n.one("#openimagebrowser").on("click",M.atto_image.open_filepicker),n}}},"@VERSION@",{requires:["node","escape"]});
